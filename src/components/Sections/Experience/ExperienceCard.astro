Q---
import type { Experience } from "@models/experience";
import Tag from "@components/UI/Tag.astro";
import { getTechIcon } from "@utils/techIcons";
import { Image } from "astro:assets";

interface Props extends Experience {
  index: number;
}

const {
  company,
  logo,
  position,
  startDate,
  endDate,
  description,
  current,
  technologies,
  index,
} = Astro.props;
---

<div
  class={`experience-card-container opacity-0 transform transition-all duration-700 py-4 ${index === 0 ? 'pt-0' : ''} ease-out border-b last:border-b-0`}
  data-index={index}
>
  <!-- Header Row: Title | Logo | Date -->
  <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between sm:gap-2 sm:gap-3 md:gap-6 mb-2">
    <!-- Position Title and Company -->
    <div class="flex items-center justify-start gap-2 w-full sm:w-auto">
      <h3 class="text-base sm:text-lg md:text-xl text-[var(--color-primary)] font-semibold">
        {position} ·
      </h3>
      <div class="flex-shrink-0">
        <div class="w-16 h-8 sm:w-20 sm:h-10 md:w-24 md:h-12 flex items-center justify-center">
          <Image
            src={logo}
            alt={`${company} logo`}
            width={96}
            height={48}
            class={`w-full h-full object-contain ${
              company === "Uniklinik Koln" 
                ? "uniklinik-logo" 
                : ""
            }`}
          />
        </div>
      </div>
    </div>

    <!-- Date Range -->
    <div
      class="text-xs sm:text-sm font-medium uppercase tracking-wide text-[var(--color-primary-dark)] whitespace-nowrap"
    >
      {startDate} — {current ? "Present" : endDate}
    </div>
  </div>

  <!-- Description -->
  {typeof description === 'string' ? (
    <p
      class="text-xs sm:text-sm leading-relaxed mb-4 text-[var(--color-text-muted)]"
    >
      {description}
    </p>
  ) : (
    <ul class="text-xs sm:text-sm leading-relaxed mb-4 space-y-2 list-disc list-inside text-[var(--color-text-muted)]">
      {description.map((point) => (
        <li>{point}</li>
      ))}
    </ul>
  )}

  <!-- Technologies Tags -->
  {
    technologies && technologies.length > 0 && (
      <div class="flex flex-wrap gap-1.5 sm:gap-2">
        {technologies.map((tech) => {
          const Icon = getTechIcon(tech);
          return <Tag label={tech} icon={Icon} />;
        })}
      </div>
    )
  }
</div>

<style>
  .experience-card-container {
    opacity: 0;
    transition: opacity 0.7s ease-out;
  }

  .experience-card-container.visible {
    opacity: 1;
  }

  :root[data-theme="dark"] .uniklinik-logo {
    filter: brightness(10) saturate(0) invert(0);
    transition: filter 0.3s ease;
  }
</style>

<script>
  function updateLogoFilter() {
    const theme = document.documentElement.getAttribute('data-theme');
    const logo = document.querySelector('.uniklinik-logo') as HTMLElement;
    
    if (logo && theme === 'dark') {
      logo.style.filter = 'brightness(10) saturate(0) invert(0)';
    } else if (logo) {
      logo.style.filter = 'none';
    }
  }

  updateLogoFilter();

  const observer = new MutationObserver(updateLogoFilter);
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
</script>
