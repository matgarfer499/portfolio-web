---
import type { Experience } from "@models/experience";
import Tag from "@components/UI/Tag.astro";
import { getTechIcon } from "@utils/techIcons";

interface Props extends Experience {
  index: number;
}

const {
  company,
  logo,
  position,
  startDate,
  endDate,
  description,
  current,
  technologies,
  index,
} = Astro.props;
---

<div
  class={`experience-card-container opacity-0 transform transition-all duration-700 py-4 ${index === 0 ? 'pt-0' : ''} ease-out border-b last:border-b-0`}
  data-index={index}
>
  <!-- Header Row: Title | Logo | Date -->
  <div class="flex items-center justify-between gap-6">
    <!-- Position Title and Company -->
    <div class="flex-1 flex items-center justify-start gap-2">
      <h3 class="text-xl text-[var(--color-primary)] font-semibold">
        {position} ·
      </h3>
      <div class="flex-shrink-0">
        <div class="w-24 h-12 flex items-center justify-center">
          <img
            src={logo}
            alt={`${company} logo`}
            class={`w-full h-full object-contain ${
              company === "Uniklinik Koln" 
                ? "uniklinik-logo" 
                : ""
            }`}
          />
        </div>
      </div>
    </div>

    <!-- Date Range -->
    <div
      class="text-sm uppercase tracking-wide whitespace-nowrap text-[var(--color-primary-dark)]"
    >
      {startDate} — {current ? "Present" : endDate}
    </div>
  </div>

  <!-- Description -->
  {typeof description === 'string' ? (
    <p
      class="text-sm leading-relaxed mb-4"
      style="color: var(--color-text-muted);"
    >
      {description}
    </p>
  ) : (
    <ul class="text-sm leading-relaxed mb-4 space-y-2 list-disc list-inside" style="color: var(--color-text-muted);">
      {description.map((point) => (
        <li>{point}</li>
      ))}
    </ul>
  )}

  <!-- Technologies Tags -->
  {
    technologies && technologies.length > 0 && (
      <div class="flex flex-wrap gap-2">
        {technologies.map((tech) => {
          const Icon = getTechIcon(tech);
          return <Tag label={tech} icon={Icon} />;
        })}
      </div>
    )
  }
</div>

<style>
  .experience-card-container.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .experience-card-container:nth-child(even) {
    transition-delay: 0.1s;
  }

  .experience-card-container:nth-child(odd) {
    transition-delay: 0.2s;
  }

  :root[data-theme="dark"] .uniklinik-logo {
    filter: brightness(10) saturate(0) invert(0);
    transition: filter 0.3s ease;
  }
</style>

<script>
  function updateLogoFilter() {
    const theme = document.documentElement.getAttribute('data-theme');
    const logo = document.querySelector('.uniklinik-logo') as HTMLElement;
    
    if (logo && theme === 'dark') {
      logo.style.filter = 'brightness(10) saturate(0) invert(0)';
    } else if (logo) {
      logo.style.filter = 'none';
    }
  }

  updateLogoFilter();

  const observer = new MutationObserver(updateLogoFilter);
  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
</script>
